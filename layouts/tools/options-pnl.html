{{ define "main" }}
<main class="container">
  <h1>{{ .Title }}</h1>
  <p class="description"><i>{{ .Description }}</i></p>
  <hr />
  <br />

  <div class="tool-instructions">{{ .Content }}</div>

  <div class="calculator-wrapper">
    <div class="calculator-sticky-header">
      <div class="calculator-stats-grid">
         <div class="calculator-stat-item">
           <span class="label">Fair Value</span>
           <span id="outFairValue" class="val">-</span>
         </div>
         <div class="calculator-stat-item">
           <span class="label">Breakeven</span>
           <span id="outBreakeven" class="val">-</span>
         </div>
         <div class="calculator-stat-item">
           <span class="label">Max Profit</span>
           <span id="outMaxProfit" class="val">-</span>
         </div>
         <div class="calculator-stat-item">
           <span class="label">Max Loss</span>
           <span id="outMaxLoss" class="val">-</span>
         </div>
       </div>
      <div class="calculator-main-display">
        <span class="label">Est. Entry Cost</span>
        <h1 id="outEntryCost">$0.00</h1>
        <div
          id="outProfitBadge"
          class="upside-badge options-pnl-profit-badge"
        ></div>
      </div>
    </div>

    <div class="calculator-body">
      <h3 class="calculator-section-head">Configuration</h3>
      <div class="calculator-row">
        <div class="calculator-field">
          <label for="inputMode">Input Mode</label>
          <select id="inputMode">
            <option value="search">Ticker Search (API)</option>
            <option value="manual">Manual Input</option>
          </select>
        </div>
        <div class="calculator-field options-pnl-visible" id="apiKeyField">
          <label for="apiKey">RapidAPI Key (Yahoo Finance) <a href="https://rapidapi.com/sparior/api" target="_blank" style="font-size: 0.85em; text-decoration: none;">â†’ get free key</a></label>
          <input type="password" id="apiKey" placeholder="Paste Key Here..." data-no-share />
        </div>
      </div>

      <h3 class="calculator-section-head">Underlying Asset</h3>
      <div class="calculator-row">
        <div class="calculator-field options-pnl-visible" id="tickerField">
          <label for="ticker">Ticker Symbol</label>
          <input type="text" id="ticker" placeholder="e.g. AAPL" value="AAPL (Demo)" />
          <div
           id="suggestions"
           class="options-pnl-suggestions"
          ></div>
        </div>
        <div class="calculator-field">
          <label for="currentPrice">Underlying Price ($)</label>
          <input type="number" id="currentPrice" value="150" step="0.01" />
        </div>
      </div>

      <h3 class="calculator-section-head">Option Strategy</h3>
      <div class="calculator-row">
        <div class="calculator-field">
          <label for="sideSelect">Position</label>
          <select id="sideSelect">
            <option value="long">Buy (Long)</option>
            <option value="short">Sell (Short)</option>
          </select>
        </div>
        <div class="calculator-field">
          <label for="typeSelect">Type</label>
          <select id="typeSelect">
            <option value="call">Call</option>
            <option value="put">Put</option>
          </select>
        </div>
      </div>

      <div class="calculator-row">
        <div class="calculator-field options-pnl-visible" id="expirySelectWrapper">
          <label for="expirySelect">Expiration</label>
          <select id="expirySelect"></select>
        </div>
        <div
         class="calculator-field options-pnl-hidden"
         id="expiryManualWrapper"
        >
          <label for="expiryInputManual">Expiration Date</label>
          <input type="date" id="expiryInputManual" />
        </div>

        <div class="calculator-field options-pnl-visible" id="strikeSelectWrapper">
          <label for="strikeSelect">Strike Price</label>
          <select id="strikeSelect"></select>
        </div>
        <div
         class="calculator-field options-pnl-hidden"
         id="strikeManualWrapper"
        >
          <label for="strikeInputManual">Strike Price ($)</label>
          <input type="number" id="strikeInputManual" value="150" />
        </div>
      </div>

      <h3 class="calculator-section-head">Pricing & Greeks</h3>
      <div class="calculator-row">
        <div class="calculator-field">
          <label for="contractPrice">Contract Price ($)</label>
          <input
            type="number"
            id="contractPrice"
            step="0.01"
          />
        </div>
        <div class="calculator-field">
          <label for="ivInput">Implied Volatility (%)</label>
          <input type="number" id="ivInput" value="30" step="0.1" />
        </div>
      </div>

      <div class="calculator-row">
        <div class="calculator-field">
          <label for="contracts">Contracts</label>
          <input type="number" id="contracts" value="1" min="1" />
        </div>
        <div class="calculator-field">
          <label for="lotSize">Units Per Contract</label>
          <input type="number" id="lotSize" value="100" min="1" />
        </div>
      </div>

      <div class="calculator-row">
        <div class="calculator-field">
          <label for="chartRange">Chart Range (+/- %)</label>
          <input type="number" id="chartRange" value="20" />
        </div>
      </div>

      <h3 class="calculator-section-head">Analysis</h3>

      <div class="calculator-dynamic-card options-pnl-chart-container">
       <canvas id="plChart"></canvas>
      </div>

      <div class="calculator-dynamic-card options-pnl-heatmap-card">
       <div class="options-pnl-heatmap-controls">
          <span class="label options-pnl-heatmap-label">P&L Heatmap</span>
          <select id="heatmapMode" onchange="setHeatmapMode(this.value)">
            <option value="dollar">$ P&L</option>
            <option value="percent">% Return</option>
            <option value="value">Contract Value</option>
          </select>
         </div>
        <div id="heatmapContainer"></div>
      </div>
    </div>
  </div>

  <br />
  <hr />
  <br />
  <div class="center-items">
    <a href="/tools/" class="unchanging-link back-link"><- back to tools</a>
  </div>

  <!-- API Key Modal -->
  <div id="apiKeyModal" class="modal-overlay">
   <div class="modal-content">
     <div class="modal-header">
       <h2>Get Your RapidAPI Key</h2>
       <button class="modal-close" id="modalClose" aria-label="Close">&times;</button>
     </div>
     <div class="modal-body">
       <ol class="modal-steps">
         <li>
           <strong>Visit RapidAPI:</strong>
           <a href="https://rapidapi.com/apidojo/api/yahoo-finance1" target="_blank" rel="noopener noreferrer">
             rapidapi.com/apidojo/api/yahoo-finance1
           </a>
         </li>
         <li>
           <strong>Log in</strong> and click <strong>"Subscribe to Test"</strong> (Free Tier)
         </li>
         <li>
           <strong>Copy</strong> your <code>X-RapidAPI-Key</code>
         </li>
         <li>
           <strong>Paste</strong> it in the RapidAPI Key field above
         </li>
       </ol>
       <div id="modalErrorMsg" class="modal-error"></div>
     </div>
     <div class="modal-footer">
       <button class="modal-btn-primary" id="modalContinue">Continue</button>
     </div>
   </div>
  </div>
  </main>

{{ $shareable := resources.Get "js/shareable.js" | minify | fingerprint "sha384" }}
<script
  src="{{ $shareable.RelPermalink }}"
  integrity="{{ $shareable.Data.Integrity }}"
  defer
></script>

<script
  src="https://cdn.jsdelivr.net/npm/chart.js"
  integrity="sha384-jb8JQMbMoBUzgWatfe6COACi2ljcDdZQ2OxczGA3bGNeWe+6DChMTBJemed7ZnvJ"
  crossorigin="anonymous"
  defer
></script>

{{ $script := resources.Get "js/options-pnl.js" | minify | fingerprint "sha384" }}
<script
  src="{{ $script.RelPermalink }}"
  integrity="{{ $script.Data.Integrity }}"
  defer
></script>
{{ end }}
